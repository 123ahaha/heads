#!/bin/bash
. /etc/functions

echo '*****'
echo '***** WARNING: This will erase all keys and secrets from the TPM'
echo '*****'

read -s -p "New TPM owner password: " key_password
echo

if [ -z "$key_password" ]; then
    die "Empty owner password is not allowed"
fi

read -s -p "Repeat owner password: " key_password2
echo


if [ "$key_password" != "$key_password2" ]; then
    die "Key passwords do not match"
fi

tpmr reset "$key_password"
